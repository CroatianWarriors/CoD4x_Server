TARGETNAME:=cod4x18_dedrun
COREPATH:=src
LIBSNAMES:=version xassets zlib
EXTERNAL:=tomcrypt mbedtls
LFLAGS:=
#

ifeq ($(DEBUG),1)
MAKEFILENAME:=makefile_debug
else
MAKEFILENAME:=makefile_release
endif

ifeq ($(OS),Windows_NT)
EXT:=exe
else
EXT:=
endif

LIBDIR:=lib
TARGET:=bin/$(TARGETNAME).$(EXT)
MODULES:=$(LIBDIR)/libcod4x_core.a $(addprefix $(LIBDIR)/libcod4x_,$(addsuffix .a,$(LIBSNAMES) $(EXTERNAL)))
#
all: $(TARGET)
	@echo Done

ifeq ($(OS),Windows_NT)
$(TARGET): $(MODULES)
else
$(TARGET): $(MODULES)
endif
	g++ -o $@ $(LFLAGS) $^

$(LIBDIR)/libcod4x_core.a: $(COREPATH)
	$(MAKE) -s -C $< -f$(MAKEFILENAME) OUTPUT=$@

$(LIBDIR)/libcod4x_%.a: $(COREPATH)/%
	$(MAKE) -s -C $< -f$(MAKEFILENAME) OUTPUT=$@
